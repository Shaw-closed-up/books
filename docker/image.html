<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="/static/img/favicon.png" rel="icon" type="image/png">
    <link href="/static/xterm/xterm.css" rel="stylesheet" type="text/css"/>

    <!-- Theme CSS -->
    <link href="/static/css/theme.css" rel="stylesheet" type="text/css"/>
    <link href="/static/css/style.css" rel="stylesheet" type="text/css"/>

    <style>
     .hljs{display:block;overflow-x:auto;padding:.5em;background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{color:#569cd6;text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212;display:inline-block;width:100%}.hljs-deletion{background-color:#600;display:inline-block;width:100%}
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>

    <!-- and it's easy to individually load additional languages -->

    <title>Docker 镜像操作(image) - FreeAIHub</title>
  
    <style>

      #top_bar {
          /* background-color: #6e84a3;
          color: white;
          font: bold 12px Helvetica;
          padding: 6px 5px 4px 5px;
          border-bottom: 1px outset; */
      }
      #status {
          text-align: center;
      }
      #sendCtrlAltDelButton {
          position: fixed;
          top: 0px;
          right: 0px;
          border: 1px outset;
          padding: 5px 5px 4px 5px;
          cursor: pointer;
      }

      #screen {
        flex: 1;
        overflow: hidden;
        position: absolute;
        top: 0;
        width: 100%;
        height: calc(88vh);
      }

  </style>

  </head>
  <body class="bg-light" style="padding-top: 69px;">

    <!-- NAVBAR
    ================================================== -->
        <!-- NAVBAR
    ================================================== -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white border-bottom">
      <div class="container-fluid" style="height: 42px;">

        <!-- Brand -->
        <a class="navbar-brand" href="../index.html">

          <img src="https://freeaihub.oss-cn-beijing.aliyuncs.com/asset/images/freeaihub.svg" width="60%" alt="freeai logo">
        </a>

        <!-- Toggler -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Collapse -->
        <div class="collapse navbar-collapse" id="navbarCollapse">

          <!-- Toggler -->
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fe fe-x"></i>
          </button>

          <!-- Navigation -->
          <ul class="navbar-nav ml-auto">
         
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#banner">首页</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#banner">课程页面</a>
            </li>
            <li class="nav-item dropdown">
            
            </li>
          </ul>
        </div>

      </div>
    </nav>



    <!-- BREADCRUMB
    ================================================== -->
    <nav class="d-lg-none bg-gray-800">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col">
          </div>
          <div class="col-auto">
            <!-- Toggler -->
            <div class="navbar-dark">
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenavCollapse" aria-controls="sidenavCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            </div>

          </div>
        </div> <!-- / .row -->
      </div> <!-- / .container -->
    </nav>

    <!-- CONTENT
    ================================================== -->
    <section style="overflow: hidden;">
      <div class="container-fluid">
        <div class="row">
          <div class="menu-content col-12 col-lg-2 col-xl-2 px-lg-0 border-bottom border-bottom-lg-0 border-right-lg border-gray-300 sidenav sidenav-left">     
            <div class="collapse d-lg-block" id="sidenavCollapse">
              <div class="px-lg-3">
                <ul class="nav side-left">
                  <li><a href=./index.html>如何学习本课程</a></li>
<li><a href=./intro.html>Docker 简介</a></li>
<li><a href=./setup.html>Docker 环境安装及配置</a></li>
<li><a href=./helloworld.html>Docker 跑通第一个Docker容器</a></li>
<li><a href=./arch.html>Docker 架构</a></li>
<li><a href=./conception.html>Docker 核心概念</a></li>
<li><a href=./container-daemon.html>Docker 容器以后台方式运行</a></li>
<li><a href=./container.html>Docker 容器操作(container)</a></li>
<li><a href=./image.html>Docker 镜像操作(image)</a></li>
<li><a href=./dockerfile.html>Docker 构建镜像(dockerfile)</a></li>
<li><a href=./repository-mirror.html>Docker 镜像加速</a></li>
<li><a href=./repository.html>Docker 仓库操作(Repository)</a></li>
<li><a href=./case-webapp.html>Docker Web应用实例</a></li>
                </ul>  

              </div>
            </div>


          </div>

          <div class="entry-content col-12 col-lg-5 col-xl-5 offset-lg-2 offset-xl-2">

          <h1>Docker 镜像操作(image)</h1>
<p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p>
<p>下面我们来学习：</p>
<ul>
<li>1、管理和使用本地 Docker 主机镜像</li>
<li>2、创建镜像</li>
</ul>
<h2>列出镜像列表</h2>
<p>我们可以使用 <strong>docker images</strong> 来列出本地主机上的镜像。</p>
<pre><code class="bash">docker images
</code></pre>

<p>各个选项说明:</p>
<ul>
<li><strong>REPOSITORY：</strong>表示镜像的仓库源</li>
<li><strong>TAG：</strong>镜像的标签</li>
<li><strong>IMAGE ID：</strong>镜像ID</li>
<li><strong>CREATED：</strong>镜像创建时间</li>
<li><strong>SIZE：</strong>镜像大小</li>
</ul>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 15.10、14.04 等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p>
<p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：</p>
<pre><code class="bash">docker run -it ubuntu:20.04 /bin/bash 
</code></pre>

<p>参数说明：</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>ubuntu:15.10</strong>: 这是指用 ubuntu 15.10 版本镜像为基础来启动容器。</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li>
</ul>
<p>如果要使用版本为 20.04 的 ubuntu 系统镜像来运行容器时，命令如下：</p>
<pre><code class="bash">docker run -t -i ubuntu:20.04 /bin/bash 
</code></pre>

<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p>
<h2>获取一个新的镜像</h2>
<p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p>
<pre><code class="bash">docker pull ubuntu:18.10
</code></pre>

<p>下载完成后，我们可以直接使用这个镜像来运行容器。</p>
<h2>查找镜像</h2>
<p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <strong>https://hub.docker.com/</strong></p>
<p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个 httpd 的镜像来作为我们的 web 服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p>
<pre><code class="bash">docker search httpd
</code></pre>

<p><strong>NAME:</strong> 镜像仓库源的名称</p>
<p><strong>DESCRIPTION:</strong> 镜像的描述</p>
<p><strong>OFFICIAL:</strong> 是否 docker 官方发布</p>
<p><strong>stars:</strong> 类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
<p><strong>AUTOMATED:</strong> 自动构建。</p>
<h2>拖取镜像</h2>
<p>我们决定使用上图中的 httpd 官方版本的镜像，使用命令 docker pull 来下载镜像。</p>
<pre><code class="bash">docker pull httpd
</code></pre>

<p>下载完成后，我们就可以使用这个镜像了。</p>
<pre><code class="bash">docker run httpd
</code></pre>

<h2>创建镜像</h2>
<p>当我们从 docker 镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</p>
<ul>
<li>1、从已经创建的容器中更新镜像，并且提交这个镜像</li>
<li>2、使用 Dockerfile 指令来创建一个新的镜像</li>
</ul>
<h3>更新镜像</h3>
<p>更新镜像之前，我们需要使用镜像来创建一个容器。</p>
<pre><code class="bash">docker run -t -i --name i3 ubuntu:20.04 /bin/bash
</code></pre>

<p>在运行的容器内使用 <strong>apt-get update</strong> 命令进行更新。</p>
<p>在完成操作之后，输入 exit 命令来退出这个容器。</p>
<p>此时 ID 为 i3的容器，是按我们的需求更改的容器。我们可以通过命令 docker commit 来提交容器副本。</p>
<pre><code class="bash">docker commit i3 ubuntu:20.04.1
</code></pre>

<p>各个参数说明：</p>
<ul>
<li><strong>i3：</strong>容器名</li>
<li><strong>ubuntu:</strong> 指定要创建的目标镜像名</li>
<li>`20.04.1·指定要创建的目标镜像版本号</li>
</ul>
<p>我们可以使用 <strong>docker images</strong> 命令来查看我们的新镜像 <strong>runoob/ubuntu:v2</strong>：</p>
<pre><code class="bash">docker images
</code></pre>

<p>使用我们的新镜像 <strong>runoob/ubuntu</strong> 来启动一个容器</p>
<pre><code class="bash">docker run -t -i ubuntu:20.04.1 /bin/bash  
</code></pre>

<h3>设置镜像标签</h3>
<p>我们可以使用 docker tag 命令，为镜像添加一个新的标签。</p>
<pre><code class="bash">docker tag ubuntu:20.04 ubuntu:20.04.1
</code></pre>

<p>docker tag 镜像ID/镜像名，镜像源名(repository name)和新的标签名(tag)</p>
<p>使用 docker images 命令可以看到，<code>ubuntu:20.04</code>与<code>ubuntu:20.04.1</code>这两个镜像的ID是一致的，只是被标注上了不同的tag</p>
<pre><code class="bash">docker images
</code></pre>

<h2>删除镜像</h2>
<p>镜像删除使用 <strong>docker rmi</strong> 命令，比如我们删除 hello-world 镜像：</p>
<pre><code class="bash">ocker rmi httpd
</code></pre>
          </div>
          <backend type="v"></backend>

          <div class="col-12 col-lg-5 col-xl-5 d-none d-lg-block px-lg-0 xterm-wrapper">
             <!-- 导航 -->
            <ul class="nav nav-tabs" id="myTab">
              <li class="nav-item">
                <a class="nav-link"  href="#home">Terminal</a>
              </li>
              <li class="nav-item">
                <a class="nav-link " href="#profile">VNC</a>
              </li>
            </ul>
      
 
            <!-- 带显示效果的内容 -->
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="home" >
                <div id="term-content">
                  <div id="terminal"></div>
                </div>
                 
              </div>
			
            <div class="tab-pane fade" id="profile">	

              <div id="top_bar">
                  <div id="status">Loading</div>
                  <!-- <div id="sendCtrlAltDelButton">Send CtrlAltDel</div> -->
              </div>
              <div id="screen">
                  <!-- This is where the remote screen will appear -->
              </div>
			      </div>
           
        </div>
          </div>
        </div> <!-- / .row -->
      </div>
    </section>

    <!-- JAVASCRIPT
    ================================================== -->
    <!-- Libs JS -->
    <script src="https://landkit.goodthemes.co/assets/libs/jquery/dist/jquery.min.js"></script>
    <script src="https://landkit.goodthemes.co/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Theme JS -->
    <!-- <script src="https://landkit.goodthemes.co/assets/js/theme.min.js"></script> -->

    <script src="/static/js/popper.min.js"></script>

    <script src="/static/xterm/xterm.js"></script>
    <script src="/static/xterm/xterm-addon-fit.js"></script>
    <script src="/static/xterm/xterm-addon-attach.js"></script>
    <!-- Promise polyfill for IE11 -->
    <script src="/vendor/promise.js"></script>
        
    <!-- ES2015/ES6 modules polyfill -->
    <script nomodule src="/vendor/browser-es-module-loader/dist/browser-es-module-loader.js"></script>
 
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
     <script>
        var terminal; // 终端
        var sockId;  // 终端 id
        var socket; // websocket 服务

        const isWindows = ['Windows', 'Win16', 'Win32', 'WinCE'].indexOf(navigator.platform) >= 0;
        terminal = new Terminal({
            windowsMode: isWindows,
            convertEol: true,
            fontFamily: `'Fira Mono', monospace`,
            fontSize: 16,
            fontWeight: 400,
            rendererType: "canvas" // canvas 或者 dom
        });
        const fitAddon = new FitAddon.FitAddon();
        terminal.loadAddon(fitAddon);

        terminal.open(document.getElementById('terminal'));
        terminal.element.style.padding = '20px';
        fitAddon.fit();

        terminal.onData(function(data) {
            socket.send(JSON.stringify({'data': data}));
            fitAddon.fit();
        });

        $.ajax({
          type: 'get',
          url: 'https://api.freeaihub.com/api/env/get/webssh',
          mode: "no-cors",
          dataType: "json",
          xhrFields: {
              withCredentials: true
          },
          crossDomain: true,  
          success: async function(data) {
            if(data.errno == 0){
              let { ...json } =  data.data
              let formdata = new FormData();
              formdata.append("hostname", json.hostname);
              formdata.append("username", json.username);
              formdata.append("port", json.port);
              formdata.append("password", json.password);
              formdata.append("term", json.term);
              let response = await fetch(
                json.host,
                  {
                      method: 'POST',
                      body: formdata
                  }
              )

          

              sockId = await response.json();
            
              let socketHost = json.ssh_host +=`/ws?id=${sockId.id}`;
              console.log(socketHost)
              socket = new WebSocket(socketHost);

              socket.onopen = () => {
                terminal.loadAddon(new AttachAddon.AttachAddon(socket));
                terminal._initialized = true;
              }

              socket.onmessage= (term) => {
                if(!terminal._initialized){
                    return
                }
                terminal._initialized = false;
                socket.send(JSON.stringify({ resize: [term.cols, term.rows] }));
              }

            }

          }
        })

     </script> 
    <script>
      function randomWord(randomFlag, min, max){
        let str = "",
            range = min,
            arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    
        // 随机产生
        if(randomFlag){
            range = Math.round(Math.random() * (max-min)) + min;
        }
        for(let i=0; i<range; i++){
            let pos = Math.round(Math.random() * (arr.length-1));
            str += arr[pos];
        }
        return str;
      }


    let uuidCookie = randomWord(false, 16)  


    if(Cookies.get('uuid') == null) {
        Cookies.set('uuid', uuidCookie, { path: '/', domain: '.freeaihub.com'})
    }
    </script>

     <!-- actual script modules -->
    <script type="module" crossorigin="anonymous">
         // RFB holds the API to connect and communicate with a VNC server
         import RFB from '/core/rfb.js';
 
         let rfb;
         let desktopName;
 
         // When this function is called we have
         // successfully connected to a server
         function connectedToServer(e) {
            //  status("Connected to " + desktopName);
         }
 
         // This function is called when we are disconnected
         function disconnectedFromServer(e) {
             if (e.detail.clean) {
                 status("Disconnected");
             } else {
                 status("Something went wrong, connection is closed");
             }
         }
 
         // When this function is called, the server requires
         // credentials to authenticate
         function credentialsAreRequired(e) {
             const password = prompt("Password Required:");
             rfb.sendCredentials({ password: password });
         }
 
         // When this function is called we have received
         // a desktop name from the server
         function updateDesktopName(e) {
             desktopName = e.detail.name;
         }
 
         // Since most operating systems will catch Ctrl+Alt+Del
         // before they get a chance to be intercepted by the browser,
         // we provide a way to emulate this key sequence.
         function sendCtrlAltDel() {
             rfb.sendCtrlAltDel();
             return false;
         }
 
         // Show a status text in the top bar
         function status(text) {
             document.getElementById('status').textContent = text;
         }
 
         // This function extracts the value of one variable from the
         // query string. If the variable isn't defined in the URL
         // it returns the default value instead.
         function readQueryVariable(name, defaultValue) {
             // A URL with a query parameter can look like this:
             // https://www.example.com?myqueryparam=myvalue
             //
             // Note that we use location.href instead of location.search
             // because Firefox < 53 has a bug w.r.t location.search
             const re = new RegExp('.*[?&]' + name + '=([^&#]*)'),
                   match = document.location.href.match(re);
 
             if (match) {
                 // We have to decode the URL since want the cleartext value
                 return decodeURIComponent(match[1]);
             }
 
             return defaultValue;
         }
 
        //  document.getElementById('sendCtrlAltDelButton')
        //      .onclick = sendCtrlAltDel;
         
        $('#myTab a:first').tab('show');//初始化显示哪个tab 
      
        $('#myTab a').click(function (e) { 
          e.preventDefault();//阻止a链接的跳转行为 
          $(this).tab('show');//显示当前选中的链接及关联的content 
        })  

        $('#myTab a[href="#profile"]').on('click', function (e) {
          $.ajax({
           type: 'get',
           url: 'https://api.freeaihub.com/api/env/get/vnc',
           mode: "no-cors",
           dataType: "json",
           xhrFields: {
               withCredentials: true
           },
           crossDomain: true,  
           success: function(data) {
             if(data.errno == 0){
               let { ...json } =  data.data
   
               vnc(json)
             }
           }
         })
        });

  


         function vnc(obj){
         
             // Build the websocket URL used to connect
             let url;

     
             url = obj.url
     
             // Creating a new RFB object will start a new connection
             rfb = new RFB(document.getElementById('screen'), url,
                               { 
                                 credentials: { password: obj.token },

                                });
     
             // Add listeners to important events from the RFB module
             rfb.addEventListener("connect",  connectedToServer);
             rfb.addEventListener("disconnect", disconnectedFromServer);
             rfb.addEventListener("credentialsrequired", credentialsAreRequired);
             rfb.addEventListener("desktopname", updateDesktopName);
          
             // Set parameters that can be changed on an active connection
             rfb.viewOnly = readQueryVariable('view_only', false);
             rfb.scaleViewport = 'scale';

         }
        
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
      });
    </script>
  </body>
</html>