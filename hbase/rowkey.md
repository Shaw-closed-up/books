# HBase 行键(Row Key)

#### 原因

在设计 rowkey 时，有大量连续编号的 rowkey。这就会导致大量 rowkey 相近的记录集中在个别 region 里，也就是集中在一台或几台 regionServer 当中。当 client 检索记录时，对个别 region 访问过多，这时此 region 所在的主机过载，就导致热点问题的出现。

#### 影响

对于 HBase 来说，一旦存在热点问题，便会导致 HBase 的读写大量集中与一台或少数的几台 regionServer 当中。这时，会造成 HBase 集群的负载不均衡，大幅度降低 HBase 的响应速度。

rowkey 设计首先应当遵循三大原则。

#### rowkey 长度原则

rowkey 是一个二进制码流，可以为任意字符串，最大长度为 64kb，实际应用中一般为 10-100bytes，它以 byte[] 形式保存，一般设定成定长。

一般越短越好，不要超过 16 个字节，注意原因如下：

1、目前操作系统都是 64 位系统，内存 8 字节对齐，控制在 16 字节，8 字节的整数倍利用了操作系统的最佳特性。

2、HBase 将部分数据加载到内存当中，如果 rowkey 过长，内存的有效利用率就会下降。

#### rowkey 散列原则

如果 rowkey 按照时间戳的方式递增，不要将时间放在二进制码的前面，建议将 rowkey 的高位字节采用散列字段处理，由程序随即生成。低位放时间字段，这样将提高数据均衡分布，各个 regionServer 负载均衡的几率。

如果不进行散列处理，首字段直接使用时间信息，所有该时段的数据都将集中到一个 regionServer 当中，这样当检索数据时，负载会集中到个别 regionServer 上，造成热点问题，会降低查询效率。

#### rowkey 唯一原则

必须在设计上保证其唯一性，rowkey 是按照字典顺序排序存储的，因此，设计 rowkey 的时候，要充分利用这个排序的特点，将经常读取的数据存储到一块，将最近可能会被访问的数据放到一块。但是这里的量不能太大，如果太大需要拆分到多个节点上去。

所以良好的 rowkey 设计，应当遵循三大原则，并且能让数据分散，从而避免热点问题。本节介绍几种常用的 rowkey 设计方法，以供同学们学习。
